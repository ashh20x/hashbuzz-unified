-- ALTER TABLE user_user
-- ADD CONSTRAINT unique_personal_twitter_id UNIQUE (personal_twitter_id);

-- ALTER TABLE user_user
-- ADD CONSTRAINT unique_personal_twitter_handle UNIQUE (personal_twitter_handle);

-- Nullify duplicates for personal_twitter_id
-- WITH ranked_users AS (
--   SELECT
--     id,
--     personal_twitter_id,
--     ROW_NUMBER() OVER (PARTITION BY personal_twitter_id ORDER BY date_joined DESC) AS rn
--   FROM user_user
--   WHERE personal_twitter_id IS NOT NULL
-- )
-- UPDATE user_user
-- SET personal_twitter_id = NULL
-- WHERE id IN (
--   SELECT id
--   FROM ranked_users
--   WHERE rn > 1
-- );

-- WITH ranked_users AS (
--   SELECT
--     id,
--     personal_twitter_handle,
--     ROW_NUMBER() OVER (PARTITION BY personal_twitter_handle ORDER BY date_joined DESC) AS rn
--   FROM user_user
--   WHERE personal_twitter_handle IS NOT NULL
-- )
-- UPDATE user_user
-- SET personal_twitter_handle = NULL
-- WHERE id IN (
--   SELECT id
--   FROM ranked_users
--   WHERE rn > 1
-- );